---
import CentreText from "@/components/centre-text.astro";
import FullWidthImage from "@/components/full-width-image.astro";
import ProductHero from "@/components/product-hero";
import Layout from "@/layouts/Layout.astro";
import ProductBenefits from "@/components/product-benefits/benefit-wrapper.astro";
import ProductShowcase from "@/components/product-showcase";
import ComparisonWrapper from "@/components/comparison/comparison-wrapper.astro";
import { getProductBySlug, getProductHeroData } from "@/data/products/helpers";

const { env } = Astro.locals.runtime;
const withFriction = env.WITH_AI_FRICTION === "true" ? true : false;
const aiEnabled = env.AI_ENABLED === "true" ? true : false;

const { slug } = Astro.params;
if (!slug) {
  return Astro.redirect("/404");
}

const product = getProductBySlug(slug);
if (!product) {
  return Astro.redirect("/404");
}

const heroData = getProductHeroData(product);
---

<Layout title={product.name} description={product.blurb}>
  <ProductHero client:load {...heroData} withFriction={withFriction} aiEnabled={aiEnabled} />
  <CentreText
    title="Bring your fitness goals into focus"
    titleSize="sm"
    description={product.centreTextBlock.description}
  />
  <FullWidthImage
    src="https://reebok.bynder.com/transform/992a1d94-a3ad-4ce3-87b0-b11dafa03826/SS25_NanoGym-Barrys_Masthead_DT?fm=jpg&q=90&fit=fill&w=1200p"
    alt="Black-2"
  />
  <ProductBenefits benefits={product.benefits} productName={product.name} />
  <ComparisonWrapper />
  {/* Feature blocks */}
  {
    product.featureBlocks.map((block, index) => (
      <ProductShowcase
        reverse={index % 2 === 1}
        label={block.subtitle}
        title={block.title}
        description={block.description}
        image={block.image}
      />
    ))
  }
</Layout>
